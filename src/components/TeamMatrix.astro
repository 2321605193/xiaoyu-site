---
import agents from '../data/agents.json';

const levelStyles = [
  { accent: '#22d3ee', bg: 'rgba(34,211,238,0.06)', border: 'rgba(34,211,238,0.18)', tagBg: 'rgba(34,211,238,0.08)', tagColor: '#22d3ee' },
  { accent: '#a78bfa', bg: 'rgba(167,139,250,0.06)', border: 'rgba(167,139,250,0.15)', tagBg: 'rgba(167,139,250,0.08)', tagColor: '#a78bfa' },
  { accent: '#fbbf24', bg: 'rgba(251,191,36,0.06)', border: 'rgba(251,191,36,0.12)', tagBg: 'rgba(251,191,36,0.08)', tagColor: '#fbbf24' },
];
---

<div class="section-divider"></div>

<section id="team" class="py-24 md:py-28 px-6" style="background: var(--bg-primary);">
  <div class="max-w-6xl mx-auto">
    <div class="reveal">
      <div class="section-label">Team Matrix</div>
      <h2 class="section-title">团队矩阵</h2>
      <p class="section-desc">三层架构，16 位专精助手，各司其职。不只是聊天机器人。</p>
    </div>

    {agents.levels.map((level, li) => {
      const s = levelStyles[li];
      return (
        <div class="mt-12 reveal" style={`transition-delay: ${li * 0.12}s`}>
          {/* Level header */}
          <div class="flex items-center gap-3 mb-5">
            <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full" style={`font-family: var(--font-mono); font-size: 0.7rem; letter-spacing: 0.12em; text-transform: uppercase; color: ${s.accent}; background: ${s.bg}; border: 1px solid ${s.border};`}>
              <span style={`width: 5px; height: 5px; border-radius: 50%; background: ${s.accent};`}></span>
              {level.name}
            </span>
            <div class="flex-1" style={`height: 1px; background: linear-gradient(90deg, ${s.border}, transparent 80%);`}></div>
            {level.parent && (
              <span style="font-family: var(--font-mono); font-size: 0.65rem; color: var(--text-muted);">← 隶属 {level.parent}</span>
            )}
          </div>

          {/* Boss card */}
          {li === 0 ? (
            <div class="max-w-sm mx-auto">
              {level.agents.map(agent => (
                <div class="card-spotlight gradient-border rounded-2xl p-6 group cursor-pointer" style="background: var(--bg-card);">
                  <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl transition-all duration-200" style={`background: linear-gradient(135deg, ${s.bg}, rgba(96,165,250,0.06)); border: 1px solid ${s.border};`}>
                      {agent.emoji}
                    </div>
                    <div>
                      <div class="flex items-center gap-2">
                        <span class="font-bold text-lg" style="font-family: var(--font-heading); color: var(--text-primary);">{agent.name}</span>
                        {agent.status === 'online' && <span class="status-dot"></span>}
                      </div>
                      <p style={`color: ${s.accent}; font-size: 0.85rem; font-weight: 500; margin-top: 2px;`}>{agent.role}</p>
                    </div>
                  </div>
                  <div class="mt-4 flex flex-wrap gap-1.5">
                    {agent.tags.map((tag: string) => (
                      <span class="tag" style={`background: ${s.tagBg}; color: ${s.tagColor};`}>{tag}</span>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div class={`grid gap-3 ${li === 2 ? 'grid-cols-2 sm:grid-cols-3 lg:grid-cols-4' : 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3'}`}>
              {level.agents.map((agent, i) => (
                <div class="card-spotlight rounded-xl p-4 group cursor-pointer transition-all duration-200" style={`background: var(--bg-card); border: 1px solid var(--border-subtle);`}
                  data-hover-border={s.border}>
                  <div class="flex items-start gap-3">
                    <div class={`flex items-center justify-center rounded-lg shrink-0 transition-all duration-200 ${li === 2 ? 'w-8 h-8 text-base' : 'w-10 h-10 text-xl'}`} style={`background: ${s.bg};`}>
                      {agent.emoji}
                    </div>
                    <div class="flex-1 min-w-0">
                      <div class="flex items-center gap-2">
                        <span class={`font-semibold truncate ${li === 2 ? 'text-[0.85rem]' : 'text-[0.92rem]'}`} style="font-family: var(--font-heading); color: var(--text-primary);">{agent.name}</span>
                        {agent.status === 'online' && <span class="status-dot"></span>}
                        {agent.status === 'idle' && <span class="w-1.5 h-1.5 rounded-full shrink-0" style="background: #fbbf24;"></span>}
                      </div>
                      <p class={`truncate ${li === 2 ? 'text-[0.72rem]' : 'text-[0.8rem]'}`} style="color: var(--text-secondary); margin-top: 1px;">{agent.role}</p>
                    </div>
                  </div>
                  {li !== 2 && (
                    <div class="mt-3 flex flex-wrap gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                      {agent.tags.map((tag: string) => (
                        <span class="tag" style={`background: ${s.tagBg}; color: ${s.tagColor};`}>{tag}</span>
                      ))}
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}

          {/* Connector */}
          {li < agents.levels.length - 1 && (
            <div class="flex justify-center mt-6">
              <div style={`width: 1px; height: 28px; background: linear-gradient(to bottom, ${s.border}, ${levelStyles[li+1]?.border || 'transparent'});`}></div>
            </div>
          )}
        </div>
      );
    })}
  </div>
</section>

<script>
  document.querySelectorAll<HTMLElement>('#team [data-hover-border]').forEach(card => {
    const c = card.dataset.hoverBorder!;
    card.addEventListener('mouseenter', () => {
      card.style.borderColor = c;
      card.style.background = 'var(--bg-card-hover)';
      card.style.transform = 'translateY(-2px)';
      card.style.boxShadow = `0 8px 24px ${c}20`;
    });
    card.addEventListener('mouseleave', () => {
      card.style.borderColor = '';
      card.style.background = '';
      card.style.transform = '';
      card.style.boxShadow = '';
    });
  });
</script>
