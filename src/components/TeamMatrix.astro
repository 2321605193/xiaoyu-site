---
import agents from '../data/agents.json';

const levelColors = [
  { accent: 'var(--accent-cyan)', bg: 'rgba(34, 211, 238, 0.08)', border: 'rgba(34, 211, 238, 0.25)' },
  { accent: 'var(--accent-purple)', bg: 'rgba(139, 92, 246, 0.06)', border: 'rgba(139, 92, 246, 0.15)' },
  { accent: 'var(--accent-gold)', bg: 'rgba(212, 168, 83, 0.06)', border: 'rgba(212, 168, 83, 0.15)' },
];
---

<div style="height: 1px; background: linear-gradient(90deg, transparent, var(--border-light), transparent);"></div>

<section id="team" class="py-28 px-6" style="background: var(--bg-primary);">
  <div class="max-w-[1080px] mx-auto">
    <div class="reveal">
      <div class="section-label">Team Matrix</div>
      <h2 class="section-title">团队矩阵</h2>
      <p class="section-desc">不只是聊天机器人。三层架构，16 位专精助手，各司其职。</p>
    </div>

    {agents.levels.map((level, li) => {
      const color = levelColors[li] || levelColors[1];
      return (
        <div class="mt-12 reveal" style={`transition-delay: ${li * 0.1}s`}>
          {/* Level header with connection line */}
          <div class="flex items-center gap-3 mb-6">
            <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full"
              style={`font-family: var(--font-mono); font-size: 0.7rem; letter-spacing: 0.12em; text-transform: uppercase; color: ${color.accent}; background: ${color.bg}; border: 1px solid ${color.border};`}>
              <span style={`width: 6px; height: 6px; border-radius: 50%; background: ${color.accent};`}></span>
              {level.name}
            </span>
            <div class="flex-1" style={`height: 1px; background: linear-gradient(90deg, ${color.border}, transparent);`}></div>
            {level.parent && (
              <span style="font-family: var(--font-mono); font-size: 0.65rem; color: var(--text-muted);">
                ← 隶属 {level.parent}
              </span>
            )}
          </div>

          {/* Connection line from boss to functional layer */}
          {li === 0 && (
            <div class="flex justify-center mt-4 mb-0">
              <div style="width: 1px; height: 32px; background: linear-gradient(to bottom, rgba(34, 211, 238, 0.3), rgba(139, 92, 246, 0.15));"></div>
            </div>
          )}
          {li === 1 && (
            <div class="flex justify-center mt-4 mb-0" style="margin-top: -8px;">
              <div style="width: 1px; height: 24px; background: linear-gradient(to bottom, rgba(139, 92, 246, 0.2), rgba(212, 168, 83, 0.1));"></div>
            </div>
          )}

          {/* Boss card — special treatment */}
          {li === 0 ? (
            <div class="max-w-md mx-auto">
              {level.agents.map(agent => (
                <div class="card-spotlight gradient-border rounded-2xl p-6 cursor-pointer group"
                  style="background: var(--bg-card);">
                  <div class="flex items-center gap-4">
                    <div class="flex items-center justify-center w-14 h-14 rounded-xl"
                      style="background: linear-gradient(135deg, rgba(34, 211, 238, 0.15), rgba(74, 158, 255, 0.1)); font-size: 1.8rem;">
                      <span class="group-hover:scale-110 transition-transform duration-300 inline-block">{agent.emoji}</span>
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center gap-2.5">
                        <span class="font-bold" style="font-family: var(--font-heading); color: var(--text-primary); font-size: 1.2rem;">{agent.name}</span>
                        {agent.status === 'online' && <span class="status-dot"></span>}
                      </div>
                      <p style="color: var(--accent-cyan); font-size: 0.85rem; margin-top: 2px; font-weight: 500;">{agent.role}</p>
                    </div>
                  </div>
                  <div class="mt-4 flex flex-wrap gap-1.5">
                    {agent.tags.map((tag: string) => (
                      <span style="font-size: 0.7rem; padding: 2px 10px; border-radius: 6px; background: rgba(34, 211, 238, 0.08); color: var(--accent-cyan); font-family: var(--font-mono); font-weight: 500;">
                        {tag}
                      </span>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            /* Functional & Platform layers */
            <div class={`grid gap-3 ${li === 2 ? 'grid-cols-2 sm:grid-cols-3 lg:grid-cols-4' : 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3'}`}>
              {level.agents.map((agent, i) => (
                <div class="card-spotlight rounded-xl p-4 cursor-pointer group"
                  style={`background: var(--bg-card); border: 1px solid var(--border-subtle); transition: all 0.3s ease; transition-delay: ${i * 0.03}s;`}
                  data-hover-border={color.border}>
                  <div class="flex items-start gap-3">
                    <div class="flex items-center justify-center w-9 h-9 rounded-lg shrink-0"
                      style={`background: ${color.bg}; font-size: ${li === 2 ? '1rem' : '1.15rem'};`}>
                      <span class="group-hover:scale-110 transition-transform duration-300 inline-block">{agent.emoji}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                      <div class="flex items-center gap-2">
                        <span class="font-semibold truncate" style={`font-family: var(--font-heading); color: var(--text-primary); font-size: ${li === 2 ? '0.85rem' : '0.95rem'};`}>{agent.name}</span>
                        {agent.status === 'online' && <span class="status-dot"></span>}
                        {agent.status === 'idle' && <span class="w-1.5 h-1.5 rounded-full shrink-0" style="background: #fbbf24;"></span>}
                      </div>
                      <p class="truncate" style={`color: var(--text-secondary); font-size: ${li === 2 ? '0.75rem' : '0.8rem'}; margin-top: 2px;`}>{agent.role}</p>
                    </div>
                  </div>
                  {li !== 2 && (
                    <div class="mt-2.5 flex flex-wrap gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                      {agent.tags.map((tag: string) => (
                        <span style={`font-size: 0.65rem; padding: 1px 8px; border-radius: 5px; background: ${color.bg}; color: ${color.accent}; font-family: var(--font-mono); font-weight: 500;`}>
                          {tag}
                        </span>
                      ))}
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}
        </div>
      );
    })}
  </div>
</section>

<script>
  // Card hover border color
  document.querySelectorAll<HTMLElement>('[data-hover-border]').forEach(card => {
    const borderColor = card.dataset.hoverBorder!;
    card.addEventListener('mouseenter', () => {
      card.style.borderColor = borderColor;
    });
    card.addEventListener('mouseleave', () => {
      card.style.borderColor = 'var(--border-subtle)';
    });
  });
</script>
